import{_ as de,D as ce,a5 as me,G as q,l as ge,I as re,K as ve,L as le,N as be,g as V,O as pe,P as N,o as z,c as C,a as y,F as H,Z as oe,t as O,V as fe,U as F,W as ne,b as n,X as ie,a0 as M,a1 as ye,r as A,v as he,a2 as X,w as s,a3 as v,h as d,a4 as _e,d as E}from"./BqDk7vYE.js";import{_ as ke,m as Ve,j as se,k as Ae}from"./6J7fcwRE.js";import{a as Ie,_ as ze,b as Ce}from"./B16jJ9f5.js";import{_ as we}from"./bLOzmhKm.js";import{u as Se,B,C as ue}from"./D7peMnsk.js";import{d as Ue,_ as $e,a as Be}from"./Dg9qKYs-.js";import"./T2nn6245.js";const I=ce(q.ui.strategy,q.ui.select,me),Te=ge({components:{UIcon:re},inheritAttrs:!1,props:{modelValue:{type:[String,Number,Object],default:""},id:{type:String,default:null},name:{type:String,default:null},placeholder:{type:String,default:null},required:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},icon:{type:String,default:null},loadingIcon:{type:String,default:()=>I.default.loadingIcon},leadingIcon:{type:String,default:null},trailingIcon:{type:String,default:()=>I.default.trailingIcon},trailing:{type:Boolean,default:!1},leading:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},padded:{type:Boolean,default:!0},options:{type:Array,default:()=>[]},size:{type:String,default:null,validator(e){return Object.keys(I.size).includes(e)}},color:{type:String,default:()=>I.default.color,validator(e){return[...q.ui.colors,...Object.keys(I.color)].includes(e)}},variant:{type:String,default:()=>I.default.variant,validator(e){return[...Object.keys(I.variant),...Object.values(I.color).flatMap(h=>Object.keys(h))].includes(e)}},optionAttribute:{type:String,default:"label"},valueAttribute:{type:String,default:"value"},selectClass:{type:String,default:null},class:{type:[String,Object,Array],default:()=>""},ui:{type:Object,default:()=>({})}},emits:["update:modelValue","change"],setup(e,{emit:h,slots:w}){const{ui:o,attrs:_}=ve("select",le(e,"ui"),I,le(e,"class")),{size:k,rounded:$}=be({ui:o,props:e}),{emitFormChange:m,inputId:g,color:u,size:T,name:p}=Se(e,I),r=V(()=>k.value||T.value),f=i=>{h("update:modelValue",i.target.value)},x=i=>{m(),h("change",i)},P=i=>M(i,e.valueAttribute,M(i,e.optionAttribute)),W=i=>M(i,e.optionAttribute,M(i,e.valueAttribute)),L=i=>["string","number","boolean"].includes(typeof i)?{[e.valueAttribute]:i,[e.optionAttribute]:i}:{...i,[e.valueAttribute]:P(i),[e.optionAttribute]:W(i)},R=V(()=>e.options.map(i=>L(i))),G=V(()=>e.placeholder?[{[e.valueAttribute]:"",[e.optionAttribute]:e.placeholder,disabled:!0},...R.value]:R.value),Y=V(()=>{const i=L(e.modelValue),c=G.value.find(j=>j[e.valueAttribute]===i[e.valueAttribute]);return c?c[e.valueAttribute]:""}),Q=V(()=>{var c,j;const i=((j=(c=o.value.color)==null?void 0:c[u.value])==null?void 0:j[e.variant])||o.value.variant[e.variant];return pe(N(o.value.base,o.value.form,$.value,o.value.size[r.value],e.padded?o.value.padding[r.value]:"p-0",i==null?void 0:i.replaceAll("{color}",u.value),(K.value||w.leading)&&o.value.leading.padding[r.value],(D.value||w.trailing)&&o.value.trailing.padding[r.value]),e.placeholder&&!e.modelValue&&o.value.placeholder,e.selectClass)}),K=V(()=>e.icon&&e.leading||e.icon&&!e.trailing||e.loading&&!e.trailing||e.leadingIcon),D=V(()=>e.icon&&e.trailing||e.loading&&e.trailing||e.trailingIcon),J=V(()=>e.loading?e.loadingIcon:e.leadingIcon||e.icon),a=V(()=>e.loading&&!K.value?e.loadingIcon:e.trailingIcon||e.icon),l=V(()=>N(o.value.icon.leading.wrapper,o.value.icon.leading.pointer,o.value.icon.leading.padding[r.value])),b=V(()=>N(o.value.icon.base,u.value&&q.ui.colors.includes(u.value)&&o.value.icon.color.replaceAll("{color}",u.value),o.value.icon.size[r.value],e.loading&&o.value.icon.loading)),S=V(()=>N(o.value.icon.trailing.wrapper,o.value.icon.trailing.pointer,o.value.icon.trailing.padding[r.value])),U=V(()=>N(o.value.icon.base,u.value&&q.ui.colors.includes(u.value)&&o.value.icon.color.replaceAll("{color}",u.value),o.value.icon.size[r.value],e.loading&&!K.value&&o.value.icon.loading));return{ui:o,attrs:_,name:p,inputId:g,normalizedOptionsWithPlaceholder:G,normalizedValue:Y,isLeading:K,isTrailing:D,selectClass:Q,leadingIconName:J,leadingIconClass:b,leadingWrapperIconClass:l,trailingIconName:a,trailingIconClass:U,trailingWrapperIconClass:S,onInput:f,onChange:x}}}),je=["id","name","value","required","disabled"],Oe=["value","label"],Ke=["value","selected","disabled","textContent"],Ne=["value","selected","disabled","textContent"];function Fe(e,h,w,o,_,k){const $=re;return z(),C("div",{class:F(e.ui.wrapper)},[y("select",fe({id:e.inputId,name:e.name,value:e.modelValue,required:e.required,disabled:e.disabled,class:e.selectClass},e.attrs,{onInput:h[0]||(h[0]=(...m)=>e.onInput&&e.onInput(...m)),onChange:h[1]||(h[1]=(...m)=>e.onChange&&e.onChange(...m))}),[(z(!0),C(H,null,oe(e.normalizedOptionsWithPlaceholder,(m,g)=>(z(),C(H,null,[m.children?(z(),C("optgroup",{key:`${m[e.valueAttribute]}-optgroup-${g}`,value:m[e.valueAttribute],label:m[e.optionAttribute]},[(z(!0),C(H,null,oe(m.children,(u,T)=>(z(),C("option",{key:`${u[e.valueAttribute]}-${g}-${T}`,value:u[e.valueAttribute],selected:u[e.valueAttribute]===e.normalizedValue,disabled:u.disabled,textContent:O(u[e.optionAttribute])},null,8,Ke))),128))],8,Oe)):(z(),C("option",{key:`${m[e.valueAttribute]}-${g}`,value:m[e.valueAttribute],selected:m[e.valueAttribute]===e.normalizedValue,disabled:m.disabled,textContent:O(m[e.optionAttribute])},null,8,Ne))],64))),256))],16,je),e.isLeading&&e.leadingIconName||e.$slots.leading?(z(),C("span",{key:0,class:F(e.leadingWrapperIconClass)},[ne(e.$slots,"leading",{disabled:e.disabled,loading:e.loading},()=>[n($,{name:e.leadingIconName,class:F(e.leadingIconClass)},null,8,["name","class"])],!0)],2)):ie("",!0),e.isTrailing&&e.trailingIconName||e.$slots.trailing?(z(),C("span",{key:1,class:F(e.trailingWrapperIconClass)},[ne(e.$slots,"trailing",{disabled:e.disabled,loading:e.loading},()=>[n($,{name:e.trailingIconName,class:F(e.trailingIconClass),"aria-hidden":"true"},null,8,["name","class"])],!0)],2)):ie("",!0)],2)}const Ee=de(Te,[["render",Fe],["__scopeId","data-v-b8160cf8"]]),qe=y("div",{class:"text-2xl font-bold"},"Kitoblar",-1),xe={class:"shadow-2xl border border-gray-300 dark:border-gray-500 items-center my-4"},Le={class:"flex p-4 justify-end"},Re={class:"whitespace-pre-line w-[300px]"},Ge=["src"],De={class:"flex flex-col items-center justify-center py-6 gap-3"},Me=y("span",{class:"italic text-sm"},"Ma'lumot Mavjud Emas",-1),Pe={class:"flex items-center justify-between"},We=y("h3",{class:"text-base font-semibold leading-6 text-gray-900 dark:text-white"}," Kitob Qo'shish ",-1),Ye={class:"flex items-center justify-between"},Qe=y("h3",{class:"text-base font-semibold leading-6 text-gray-900 dark:text-white"}," Kitob Qo'shish ",-1),la={__name:"index",setup(e){const h=ye();let w=A([]),o=A(!1),_=A(!1),k=A(!0),$=A([]),m=A(null),g=A(""),u=A(""),T=A(null),p=A(""),r=A(""),f=A(null),x=A(null);he(async()=>{try{const a=await $fetch(B+"/books",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}});w.value=a.data;const l=await $fetch(B+"/categories",{method:"GET"});$.value=l.data,k.value=!1}catch(a){a.response&&a.response.status===401&&(localStorage.removeItem("token"),X("/exit")),console.log(a)}});const P=[{key:"name",label:"Nomi"},{key:"photo_url",label:"Rasm"},{key:"description",label:"Batafsil"},{key:"author",label:"Yozuvchi"},{key:"price",label:"Narxi"},{key:"category",label:"Kategoriyasi"},{key:"createdAt",label:"Yaratilgan vaqti"},{key:"updatedAt",label:"Yangilangan vaqti"},{key:"actions",label:"Action"}],W=a=>[[{label:"Tahrirlash",icon:"i-heroicons-pencil-square-20-solid",click:()=>L(a)},{label:"O'chirish",icon:"i-heroicons-trash-20-solid",click:()=>Q(a._id)}],[{label:"Yuklab Olish(Kitob)",icon:"i-heroicons-archive-box-arrow-down",click:()=>G(a.book_url,a.name)},{label:"Yuklab Olish(Audio)",icon:"i-heroicons-archive-box-arrow-down",click:()=>Y(a.book_audio_url,a.name)}]],L=async a=>{_.value=!0,m.value=a._id,g.value=a.name,u.value=a.description,p.value=a.author,r.value=a.category._id,f.value=a.price},R=async()=>{k.value=!0;try{await $fetch(B+`/books/${m.value}`,{method:"PUT",body:JSON.stringify({name:g.value,description:u.value,author:p.value,category:r.value,price:f.value}),headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}});const a=await $fetch(B+"/books",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}});g.value="",u.value="",p.value="",r.value="",f.value="",w.value=a.data,_.value=!1,k.value=!1}catch(a){console.log(a)}_.value=!1},G=async(a,l)=>{const S=await(await fetch(a)).blob(),U=window.URL.createObjectURL(S),i=document.createElement("a");i.href=U,i.download=`${l}.pdf`,i.click()},Y=async(a,l)=>{const S=await(await fetch(a)).blob(),U=window.URL.createObjectURL(S),i=document.createElement("a");i.href=U,i.download=`${l}.mp3`,i.click()},Q=async a=>{k.value=!0;try{const l=await $fetch(B+"/books/"+a,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}});if(l.status===200){h.add({title:l.message});const b=await $fetch(B+"/books",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}});w.value=b.data}else h.add({title:l.message})}catch(l){l.response&&l.response.status===401&&(localStorage.removeItem("token"),X("/exit")),console.log(l)}k.value=!1};function K(a){a.target.files.length>0&&(T.value=a.target.files[0])}function D(a){a.target.files.length>0&&(x.value=a.target.files[0])}const J=async()=>{k.value=!0;try{let a=new FormData;a.append("file",T.value);const l=await $fetch(ue+"/upload",{method:"POST",body:a});a=new FormData,a.append("file",x.value);const b=await $fetch(ue+"/upload",{method:"POST",body:a}),S=await $fetch(B+"/books",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({photo_url:l.data.fileUrl,book_url:b.data.fileUrl,name:g.value,description:u.value,author:p.value,category:r.value,price:f.value})});o.value=!1,h.add({title:S.message});const U=await $fetch(B+"/books",{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}});T.value=null,w.value=U.data}catch(a){a.response&&a.response.status===401&&(localStorage.removeItem("token"),X("/exit")),console.log(a)}k.value=!1};return Ue({escape:{usingInput:!0,whenever:[o],handler:()=>{o.value=!1}}}),(a,l)=>{const b=_e,S=Ae,U=ke,i=Ie,c=ze,j=we,Z=Ee,ee=Ce,ae=Be,te=$e;return z(),C("div",null,[qe,y("div",xe,[y("div",Le,[n(b,{size:"lg",onClick:l[0]||(l[0]=t=>v(o)?o.value=!0:o=!0)},{default:s(()=>[E("Kitob Qo'shish")]),_:1})])]),n(U,{loading:d(k),"loading-state":{icon:"i-heroicons-arrow-path-20-solid",label:"Yuklanmoqda..."},progress:{color:"primary",animation:"carousel"},columns:P,rows:d(w),"empty-state":{icon:"i-heroicons-circle-stack-20-solid",label:"Bannerlar Mavjud Emas"}},{"description-data":s(({row:t})=>[y("div",Re,O(t.description),1)]),"price-data":s(({row:t})=>[y("div",null,O(("numberFormat"in a?a.numberFormat:d(Ve))(t.price))+" so'm",1)]),"photo_url-data":s(({row:t})=>[y("img",{src:t.photo_url,alt:"",class:"max-w-[100px]"},null,8,Ge)]),"category-data":s(({row:t})=>[y("div",null,O(t.category.name),1)]),"createdAt-data":s(({row:t})=>[E(O(("dateFormat"in a?a.dateFormat:d(se))(t.createdAt)),1)]),"updatedAt-data":s(({row:t})=>[E(O(("dateFormat"in a?a.dateFormat:d(se))(t.updatedAt)),1)]),"actions-data":s(({row:t})=>[n(S,{items:W(t)},{default:s(()=>[n(b,{color:"gray",variant:"ghost",icon:"i-heroicons-ellipsis-horizontal-20-solid"})]),_:2},1032,["items"])]),"empty-state":s(()=>[y("div",De,[Me,n(b,{label:"Kitob Qo'shish",onClick:l[1]||(l[1]=t=>v(o)?o.value=!0:o=!0)})])]),_:1},8,["loading","loading-state","rows"]),n(te,{modelValue:d(o),"onUpdate:modelValue":l[8]||(l[8]=t=>v(o)?o.value=t:o=t),"prevent-close":""},{default:s(()=>[n(ae,{ui:{ring:"",divide:"divide-y divide-gray-100 dark:divide-gray-800"}},{header:s(()=>[y("div",Pe,[We,n(b,{color:"gray",variant:"ghost",icon:"i-heroicons-x-mark-20-solid",class:"-my-1",onClick:l[2]||(l[2]=t=>v(o)?o.value=!1:o=!1)})])]),default:s(()=>[n(ee,{onSubmit:J},{default:s(()=>[n(c,{class:"my-[2%]",label:"Kitob Nomi",size:"lg"},{default:s(()=>[n(i,{type:"text",size:"lg",modelValue:d(g),"onUpdate:modelValue":l[3]||(l[3]=t=>v(g)?g.value=t:g=t)},null,8,["modelValue"])]),_:1}),n(c,{class:"my-[2%]",label:"Kitob Rasmi",size:"lg"},{default:s(()=>[n(i,{type:"file",size:"lg",onChange:K})]),_:1}),n(c,{class:"my-[2%]",label:"Kitob Haqida",name:"photo"},{default:s(()=>[n(j,{type:"text",size:"lg",modelValue:d(u),"onUpdate:modelValue":l[4]||(l[4]=t=>v(u)?u.value=t:u=t)},null,8,["modelValue"])]),_:1}),n(c,{class:"my-[2%]",label:"Kitob Muallifi",name:"photo"},{default:s(()=>[n(i,{type:"text",size:"lg",modelValue:d(p),"onUpdate:modelValue":l[5]||(l[5]=t=>v(p)?p.value=t:p=t)},null,8,["modelValue"])]),_:1}),n(c,{class:"my-[2%]",label:"Kitob Kategoriyasi",name:"photo"},{default:s(()=>[n(Z,{type:"text",size:"lg",options:d($),"option-attribute":"name","value-attribute":"_id",modelValue:d(r),"onUpdate:modelValue":l[6]||(l[6]=t=>v(r)?r.value=t:r=t)},null,8,["options","modelValue"])]),_:1}),n(c,{class:"my-[2%]",label:"Kitob Narxi",name:"photo"},{default:s(()=>[n(i,{type:"number",size:"lg",modelValue:d(f),"onUpdate:modelValue":l[7]||(l[7]=t=>v(f)?f.value=t:f=t)},null,8,["modelValue"])]),_:1}),n(c,{class:"my-[2%]",label:"Kitob PDF fayli",name:"photo"},{default:s(()=>[n(i,{type:"file",size:"lg",onChange:D})]),_:1}),n(c,{class:"my-[2%]",name:"submit",size:"xl"},{default:s(()=>[n(b,{loading:d(k),type:"submit",color:"primary",size:"xl",block:""},{default:s(()=>[E("Tasdiqlash")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),n(te,{modelValue:d(_),"onUpdate:modelValue":l[15]||(l[15]=t=>v(_)?_.value=t:_=t),"prevent-close":""},{default:s(()=>[n(ae,{ui:{ring:"",divide:"divide-y divide-gray-100 dark:divide-gray-800"}},{header:s(()=>[y("div",Ye,[Qe,n(b,{color:"gray",variant:"ghost",icon:"i-heroicons-x-mark-20-solid",class:"-my-1",onClick:l[9]||(l[9]=t=>v(_)?_.value=!1:_=!1)})])]),default:s(()=>[n(ee,{onSubmit:R},{default:s(()=>[n(c,{class:"my-[2%]",label:"Kitob Nomi",size:"lg"},{default:s(()=>[n(i,{type:"text",size:"lg",modelValue:d(g),"onUpdate:modelValue":l[10]||(l[10]=t=>v(g)?g.value=t:g=t)},null,8,["modelValue"])]),_:1}),n(c,{class:"my-[2%]",label:"Kitob Haqida",name:"photo"},{default:s(()=>[n(j,{type:"text",size:"lg",modelValue:d(u),"onUpdate:modelValue":l[11]||(l[11]=t=>v(u)?u.value=t:u=t)},null,8,["modelValue"])]),_:1}),n(c,{class:"my-[2%]",label:"Kitob Muallifi",name:"photo"},{default:s(()=>[n(i,{type:"text",size:"lg",modelValue:d(p),"onUpdate:modelValue":l[12]||(l[12]=t=>v(p)?p.value=t:p=t)},null,8,["modelValue"])]),_:1}),n(c,{class:"my-[2%]",label:"Kitob Kategoriyasi",name:"photo"},{default:s(()=>[n(Z,{type:"text",size:"lg",options:d($),"option-attribute":"name","value-attribute":"_id",modelValue:d(r),"onUpdate:modelValue":l[13]||(l[13]=t=>v(r)?r.value=t:r=t)},null,8,["options","modelValue"])]),_:1}),n(c,{class:"my-[2%]",label:"Kitob Narxi",name:"photo"},{default:s(()=>[n(i,{type:"number",size:"lg",modelValue:d(f),"onUpdate:modelValue":l[14]||(l[14]=t=>v(f)?f.value=t:f=t)},null,8,["modelValue"])]),_:1}),n(c,{class:"my-[2%]",name:"submit",size:"xl"},{default:s(()=>[n(b,{loading:d(k),type:"submit",color:"primary",size:"xl",block:""},{default:s(()=>[E("Tasdiqlash")]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}};export{la as default};
